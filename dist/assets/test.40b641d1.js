import{a as x}from"./index.d6b487dd.js";import{G as C,H as O,m as f,I as g,J as U,C as _,h as y,e as L,K as P,L as T,o as B,c as q,b as M,a as R,w as G,x as W,t as j}from"./vendor.1e55e93a.js";function H(e){return C()?(O(e),!0):!1}const h=typeof window!="undefined",V=e=>typeof e=="string",D=()=>{};function F(e){let t;function u(){return t||(t=e()),t}return u.reset=async()=>{const a=t;t=void 0,a&&await a},u}const J=h?window:void 0;h&&window.document;const I=h?window.navigator:void 0;function S(...e){let t,u,a,n;if(V(e[0])?([u,a,n]=e,t=J):[t,u,a,n]=e,!t)return D;let s=D;const l=_(()=>y(t),i=>{s(),!!i&&(i.addEventListener(u,a,n),s=()=>{i.removeEventListener(u,a,n),s=D})},{immediate:!0,flush:"post"}),o=()=>{l(),s()};return H(o),o}function K(e,t={}){const{controls:u=!1,navigator:a=I}=t,n=Boolean(a&&"permissions"in a);let s;const l=typeof e=="string"?{name:e}:e,o=f(),i=()=>{s&&(o.value=s.state)},c=F(async()=>{if(!!n){if(!s)try{s=await a.permissions.query(l),S(s,"change",i),i()}catch(r){o.value="prompt"}return s}});return c(),u?{state:o,isSupported:n,query:c}:o}function $(e={}){const{navigator:t=I,requestPermissions:u=!1,onUpdated:a}=e,n=f([]),s=g(()=>n.value.filter(d=>d.kind==="videoinput")),l=g(()=>n.value.filter(d=>d.kind==="audioinput")),o=g(()=>n.value.filter(d=>d.kind==="audiooutput"));let i=!1;const c=f(!1);async function r(){!i||(n.value=await t.mediaDevices.enumerateDevices(),a==null||a(n.value))}async function p(){if(!i)return!1;if(c.value)return!0;const{state:d,query:m}=K("camera",{controls:!0});return await m(),d.value!=="granted"&&((await t.mediaDevices.getUserMedia({audio:!0,video:!0})).getTracks().forEach(w=>w.stop()),r()),c.value=!0,c.value}return t&&(i=Boolean(t.mediaDevices&&t.mediaDevices.enumerateDevices),i&&(u&&p(),S(t.mediaDevices,"devicechange",r),r())),{devices:n,ensurePermissions:p,permissionGranted:c,videoInputs:s,audioInputs:l,audioOutputs:o,isSupported:i}}var b;(function(e){e.UP="UP",e.RIGHT="RIGHT",e.DOWN="DOWN",e.LEFT="LEFT",e.NONE="NONE"})(b||(b={}));function z(e={}){var t,u,a;const n=f((t=e.enabled)!=null?t:!1),s=f((u=e.autoSwitch)!=null?u:!0),l=f(e.videoDeviceId),o=f(e.audioDeviceId),{navigator:i=I}=e,c=Boolean((a=i==null?void 0:i.mediaDevices)==null?void 0:a.getUserMedia),r=U();function p(v){return v.value==="none"||v.value===!1?!1:v.value==null?!0:{deviceId:v.value}}async function d(){if(!(!c||r.value))return r.value=await i.mediaDevices.getUserMedia({video:p(l),audio:p(o)}),r.value}async function m(){var v;(v=r.value)==null||v.getTracks().forEach(k=>k.stop()),r.value=void 0}function E(){m(),n.value=!1}async function w(){return await d(),r.value&&(n.value=!0),r.value}async function N(){return m(),await w()}return _(n,v=>{v?d():m()},{immediate:!0}),_([l,o],()=>{s.value&&r.value&&N()},{immediate:!0}),{isSupported:c,stream:r,start:w,stop:E,restart:N,videoDeviceId:l,audioDeviceId:o,enabled:n,autoSwitch:s}}const A={class:"flex flex-col"},Y=L({setup(e){const t=f(),{videoInputs:u}=$({requestPermissions:!0,onUpdated(){var l;u.value.find(o=>o.deviceId===t.value)||(t.value=(l=u.value[0])==null?void 0:l.deviceId)}}),a=f(),{stream:n,enabled:s}=z({videoDeviceId:t.value});return P(()=>{a.value&&(console.log(n.value),a.value.srcObject=n.value)}),T(()=>{}),(l,o)=>{const i=x;return B(),q("div",A,[M("video",{autoplay:"",controls:"",muted:"",ref:(c,r)=>{r.videoRef=c,a.value=c},id:"testvideo",class:"h-full w-full"},null,512),R(i,{onClick:o[0]||(o[0]=c=>s.value=!y(s))},{default:G(()=>[W(j(y(s)?"stop":"start"),1)]),_:1})])}}});export{Y as default};
